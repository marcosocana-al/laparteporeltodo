<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Juegos v3.0 - La Parte por el Todo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <!-- Librería para Arrastrar y Soltar -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        #import-file-input { display: none; }
        .clue-item { cursor: grab; }
        .clue-item:active { cursor: grabbing; }
        .sortable-ghost { opacity: 0.4; background: #4f46e5; }
    </style>
</head>
<body class="text-gray-200">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight">Generador de Juegos v3.0</h1>
            <p class="mt-2 text-lg text-gray-400">La herramienta definitiva para crear, gestionar y exportar tus misterios a JSON.</p>
        </header>

        <div class="bg-gray-800 rounded-xl shadow-lg p-6 md:p-8">
            <!-- SECCIÓN DE IMPORTAR/EXPORTAR -->
            <div class="text-center mb-8 p-4 bg-gray-900/50 rounded-lg flex flex-wrap gap-4 justify-center">
                 <label for="import-file-input" class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                    Importar Juego (.json)
                </label>
                <input type="file" id="import-file-input" accept=".json">
                <button id="export-json-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                    Exportar Juego (.json)
                </button>
            </div>
            
            <div class="space-y-6">
                <!-- DATOS PRINCIPALES -->
                <fieldset class="border border-gray-700 rounded-lg p-4">
                    <legend class="text-lg font-bold text-indigo-400 px-2">Datos Principales</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="game-title" class="block text-sm font-medium text-gray-300 mb-1">Título del Juego</label>
                            <input type="text" id="game-title" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3" placeholder="Ej: Objeto Misterioso">
                        </div>
                        <div>
                            <label for="google-form-link" class="block text-sm font-medium text-gray-300 mb-1">Link a Formulario de Google</label>
                            <input type="url" id="google-form-link" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3" placeholder="https://docs.google.com/forms/...">
                        </div>
                    </div>
                </fieldset>

                <!-- PISTAS -->
                <fieldset class="border border-gray-700 rounded-lg p-4">
                    <legend class="text-lg font-bold text-indigo-400 px-2">Pistas (Arrastra para reordenar)</legend>
                    <div id="clues-list" class="space-y-3 mb-4 min-h-[50px]"></div>
                    <div class="bg-gray-900/50 rounded-lg p-4 space-y-3">
                        <h4 class="font-semibold text-white">Añadir nueva pista</h4>
                        <div class="flex flex-col sm:flex-row gap-2">
                             <select id="new-clue-type" class="bg-gray-700 border border-gray-600 rounded-lg p-3 sm:w-auto">
                                <option value="text">Texto</option>
                                <option value="image">Imagen (URL)</option>
                                <option value="audio">Audio (URL)</option>
                                <option value="video">Vídeo (URL)</option>
                            </select>
                            <input type="text" id="new-clue-content" class="flex-grow bg-gray-700 border border-gray-600 rounded-lg p-3" placeholder="Contenido o URL de la pista...">
                        </div>
                        <input type="text" id="new-clue-text" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3" placeholder="Texto descriptivo (opcional)...">
                        <button id="add-clue-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold p-3 rounded-lg transition">Añadir Pista</button>
                    </div>
                </fieldset>

                <!-- SOLUCIÓN -->
                 <fieldset class="border border-gray-700 rounded-lg p-4">
                    <legend class="text-lg font-bold text-indigo-400 px-2">Solución y Cierre</legend>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between bg-gray-700 p-3 rounded-lg">
                            <span class="font-medium">¿Marcar como resuelto?</span>
                            <label for="is-solved-toggle" class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="is-solved-toggle" class="sr-only peer"><div class="w-11 h-6 bg-gray-600 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div></label>
                        </div>
                        <div>
                            <label for="game-solution" class="block text-sm font-medium text-gray-300 mb-1">La Solución (El Todo)</label>
                            <input type="text" id="game-solution" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3" placeholder="Ej: El Cubo de Rubik">
                        </div>
                        <div>
                             <label for="game-winner" class="block text-sm font-medium text-gray-300 mb-1">Ganador/a (Opcional)</label>
                            <input type="text" id="game-winner" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3" placeholder="Ej: @nombredeusuario">
                        </div>
                        <div>
                             <label for="game-explanation" class="block text-sm font-medium text-gray-300 mb-1">Explicación de la solución</label>
                             <textarea id="game-explanation" rows="4" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3" placeholder="Explica aquí cómo cada pista conectaba con la solución final..."></textarea>
                        </div>
                    </div>
                </fieldset>

                <!-- ANOTACIONES -->
                <fieldset class="border border-gray-700 rounded-lg p-4">
                     <legend class="text-lg font-bold text-indigo-400 px-2">Anotaciones Privadas</legend>
                     <textarea id="game-notes" rows="3" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3" placeholder="Estas notas no se publican..."></textarea>
                </fieldset>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            title: '',
            googleFormLink: '',
            clues: [],
            isSolved: false,
            solution: '',
            winner: '',
            explanation: '',
            notes: '',
            id: `game-${Date.now()}`,
            lastUpdated: new Date().toISOString()
        };

        const dom = {
            title: document.getElementById('game-title'),
            googleFormLink: document.getElementById('google-form-link'),
            solution: document.getElementById('game-solution'),
            winner: document.getElementById('game-winner'),
            explanation: document.getElementById('game-explanation'),
            notes: document.getElementById('game-notes'),
            isSolved: document.getElementById('is-solved-toggle'),
            cluesList: document.getElementById('clues-list'),
            newClue: {
                type: document.getElementById('new-clue-type'),
                content: document.getElementById('new-clue-content'),
                text: document.getElementById('new-clue-text'),
                addBtn: document.getElementById('add-clue-btn')
            },
            exportBtn: document.getElementById('export-json-btn'),
            importInput: document.getElementById('import-file-input')
        };
        
        function updateStateFromUI() {
            gameState.title = dom.title.value;
            gameState.googleFormLink = dom.googleFormLink.value;
            gameState.solution = dom.solution.value;
            gameState.winner = dom.winner.value;
            gameState.explanation = dom.explanation.value;
            gameState.notes = dom.notes.value;
            gameState.isSolved = dom.isSolved.checked;
            gameState.lastUpdated = new Date().toISOString();
        }

        function updateUIFromState() {
            dom.title.value = gameState.title;
            dom.googleFormLink.value = gameState.googleFormLink;
            dom.solution.value = gameState.solution;
            dom.winner.value = gameState.winner;
            dom.explanation.value = gameState.explanation;
            dom.notes.value = gameState.notes;
            dom.isSolved.checked = gameState.isSolved;
            renderCluesList();
        }

        function renderCluesList() {
            dom.cluesList.innerHTML = '';
            gameState.clues.forEach((clue, index) => {
                const clueEl = document.createElement('div');
                clueEl.className = 'clue-item flex items-center justify-between bg-gray-700 p-2 pl-4 rounded-lg';
                clueEl.dataset.id = index;
                clueEl.innerHTML = `
                    <div class="flex items-center gap-3 text-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-grip-vertical text-gray-500" viewBox="0 0 16 16"><path d="M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>
                        <span class="text-gray-300">
                           <strong class="text-indigo-400">[${clue.type}]</strong>: ${clue.text || clue.content.substring(0, 40) + '...'}
                        </span>
                    </div>
                    <button data-index="${index}" class="remove-clue-btn text-red-400 hover:text-red-300 font-bold p-2 text-lg leading-none">&times;</button>
                `;
                dom.cluesList.appendChild(clueEl);
            });
        }
        
        function handleAddClue() {
            const type = dom.newClue.type.value;
            const content = dom.newClue.content.value.trim();
            const text = dom.newClue.text.value.trim();
            if (content) {
                gameState.clues.push({ type, content, text });
                dom.newClue.content.value = '';
                dom.newClue.text.value = '';
                dom.newClue.content.focus();
                renderCluesList();
            }
        }

        // --- Event Listeners ---
        document.body.addEventListener('input', updateStateFromUI);
        dom.newClue.addBtn.addEventListener('click', handleAddClue);

        dom.cluesList.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-clue-btn')) {
                const index = parseInt(e.target.dataset.index, 10);
                gameState.clues.splice(index, 1);
                renderCluesList();
            }
        });

        dom.exportBtn.addEventListener('click', () => {
            updateStateFromUI();
            const dataStr = JSON.stringify(gameState, null, 2);
            const dataBlob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            const safeTitle = (gameState.title || 'juego').replace(/[^a-z0-9]/gi, '_').toLowerCase();
            a.href = url;
            a.download = `${safeTitle}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });

        dom.importInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedState = JSON.parse(e.target.result);
                    if (importedState && importedState.id && Array.isArray(importedState.clues)) {
                        gameState = importedState;
                        updateUIFromState();
                    } else { alert("Error: El archivo no tiene el formato de juego esperado."); }
                } catch (error) { alert("Error al leer el archivo JSON."); console.error(error); }
            };
            reader.readAsText(file);
            event.target.value = '';
        });
        
        // --- Init SortableJS ---
        Sortable.create(dom.cluesList, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: function (evt) {
                const [reorderedItem] = gameState.clues.splice(evt.oldIndex, 1);
                gameState.clues.splice(evt.newIndex, 0, reorderedItem);
                renderCluesList();
            },
        });

        updateUIFromState();
    </script>
</body>
</html>
